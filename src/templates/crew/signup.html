{% extends "base.html" %} {% block content %}{% load static %}

<script language="javascript">
  $(document).ready(() => {
    $('#select_all_attendance').click((event) => {
      event.preventDefault()
      for (const el of $('[name^=attendance_]')) {
        el.checked = true
      }
    })

    $('#select_none_attendance').click((event) => {
      event.preventDefault()
      for (const el of $('[name^=attendance_]')) {
        el.checked = false
      }
    })
  })

  ajax_success = (data) => {
    console.info(data)
    window.location.href = "{% url "crew_signup_submitted" slug=slug %}"
  }
  ajax_error = (data) => {
    // FIXMIE: needs error handling
    console.error(data)
  }
  ajax_complete = (data) => {
    // hopenfully this is never triggered
    console.info(data)
  }

  const send_form = (fields) => {
    console.debug(fields)
    $.ajax({
      type: "POST",
      url: "{% url "api_crew_signup" slug=slug %}",
      data: JSON.stringify(fields),
      contentType: "application/json",
      headers: {
        "X-CSRFToken": fields.csrfmiddlewaretoken
      },
      dataType: "json",
      success: (data) => ajax_success(data),
      error: (data) => ajax_error(data),
      complete: (data) => ajax_complete(data)
    })
  }

</script>

<h1>Neue Crewanmeldung</h1>
<form class="row g-3">
  {% csrf_token %}
  <h2>Persönliches</h2>
  <div class="col-md-6">
    <label for="user_first_name">Vorname</label>
    <input type="text" name="user_first_name" class="form-control" id="user_first_name" placeholder="Jane" autocomplete="given-name" />
  </div>
  <div class="col-md-6">
    <label for="user_last_name">Nachname</label>
    <input type="text" name="user_last_name" class="form-control" id="user_last_name" placeholder="Doe" autocomplete="family-name" />
  </div>
  <div class="col-md-6">
    <label for="user_nick_name">Nickname</label>
    <input type="text" name="user_nick_name" class="form-control" id="user_nick_name" placeholder="Jane" autocomplete="given-name" />
  </div>
  <div class="col-md-6">
    <label for="user_birthday">Geburtstag</label>
    <input type="date" name="user_birthday" class="form-control" id="user_birthday" placeholder="01.01.1970" autocomplete="bday" />
  </div>
  <div class="col-md-9">
    <label for="user_address">Straße</label>
    <input type="text" name="user_address" class="form-control" id="user_address" placeholder="Straße" autocomplete="street-address" />
  </div>
  <div class="col-md-3">
    <label for="user_address_housenumber">Hausnummer</label>
    <input type="text" class="form-control" name="user_address_housenumber" id="user_address_housenumber" placeholder="Hausnummer" />
  </div>
  <div class="col-md-12">
    <label for="user_address_extension">Addresszusatz</label>
    <input type="text" class="form-control" name="user_address_extension" id="user_address_extension" placeholder="Addresszusatz" autocomplete="off" />
  </div>
  <div class="col-md-6">
    <label for="user_zipcode">Postleitzahl</label>
    <input type="text" pattern="[\d+]{5}" name="user_zipcode" id="user_zipcode" class="form-control" placeholder="Postleitzahl" maxlength="5" autocomplete="postal-code" />
  </div>
  <div class="col-md-6">
    <label for="user_place">Ort</label>
    <input type="text" class="form-control" name="user_place" id="user_place" placeholder="Ort" autocomplete="home city"/>
  </div>
  <h2>Kontakt</h2>
  <div class="col-md-6">
    <label for="user_zipcode">E-Mail Adresse</label>
    <input type="email" name="user_email" id="user_email" class="form-control" placeholder="E-Mail Adresse" autocomplete="email" />
  </div>
  <div class="col-md-6">
    <label for="user_place">E-Mail Adresse bestätigen</label>
    <input type="email" name="user_email_confirmation" id="user_email_confirmation" class="form-control" placeholder="E-Mail Adresse bestätigen" autocomplete="off" />
  </div>
  <div class="col-md-12">
    <label for="user_place">Handynummer</label>
    <input type="tel" name="user_mobile" id="user_mobile" class="form-control" placeholder="Handynummer" autocomplete="tel" />
  </div>
  <h2>Essen &amp; T-Shirt</h2>
  <div class="col-md-12">
    <label for="nutriton_type" class="form-label">Essensgewohnheit</label>
    <select id="nutriton_type" name="nutriton_type" class="form-select">
      <option selected>Ernährung</option>
      <option data-value="omnivore">Alles-Esser</option>
      <option data-value="vegetarian">Vegatrisch</option>
      <option data-value="vegan">Vegan</option>
    </select>
  </div>
  <div class="col-md-12">
    <label for="nutrition_note" class="form-label">Anmerkungen zu Essensgewohnheiten, Unverträglichkeiten, etc.</label>
    <textarea class="form-control" id="nutrition_note" name="nutrition_note" rows="3"></textarea>
  </div>
  <div class="col-md-12">
    <label for="crew_shirt">T-Shirt</label>
    <select id="crew_shirt" name="crew_shirt" class="form-select">
      <option selected>Schnitt und Größe</option>
      {% for shirt in shirts %}
        <option data-value="{{ shirt.id }}">{{ shirt }}</option>
      {% endfor %}
    </select>
    <div class="alert alert-info mt-3" role="alert">
      <h4 class="alert-heading">Erklärung Schnitt</h4>
      <hr>
      <ul>
        <li>fitted: figurbetonter Schnitt</li>
        <li>straight: normaler Schnitt</li>
      </ul>
    </div>
  </div>
  <h2>Formale Qualifikationen und Fähigkeiten</h2>
  <div class="col-md-12">
    <label>Welche Qualifikationen und Weiterbildungen hast du?</label>
      {% for skill in skills %}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="skill_{{ skill.id }}" name="skill_{{ skill.id }}">
        <label class="form-check-label" for="skill_{{ skill.id }}">
          {{ skill }} - <i>{{ skill.explanation }}</i>
        </label>
      </div>
      {% endfor %}
  </div>
  <div class="col-md-12">
    <label for="skills_note" class="form-label">Anmerkungen zu deinen Fähigkeiten</label>
    <textarea class="form-control" id="skills_note" name="skills_note" rows="3"></textarea>
  </div>
  <h4 class="ui dividing header">Anwesenheit</h4>
  <div class="field">
    <label>An welchen Tagen kannst du vor Ort sein?</label>
    <div class="equal width fields">
      <div class="field">
        <button id="select_all_attendance" class="fluid ui tiny teal button">Alle Tage auswählen</button>
      </div>
      <div class="field">
        <button id="select_none_attendance" class="fluid ui tiny grey button">Alle Tage abwählen</button>
      </div>
    </div>
    {% for phase in attendance_phases %}
    <label>{{ phase.name }}</label>
    <div class="ui large aligned divided list">
    {% for day in phase.days %}
      <div class="item">
        <div class="right floated content">
          <div class="ui checkbox"><input type="checkbox" tabindex="0" class="hidden" name="attendance_{{ day.id }}"></div>
        </div>
        <div class="content">
          <label>{{ day }}</label>
        </div>
      </div>
    {% endfor %}
    </div>
    {% endfor %}
  </div>
  <div class="field">
    <label>Anmerkungen zu deiner Anwesenheit</label>
    <textarea rows="2" name="attendance_note"></textarea>
  </div>
  <div class="inline field">
    <div class="ui toggle checkbox">
      <input type="checkbox" tabindex="0" class="hidden" name="stays_overnight" disabled>
      <label>Ich übernachte vor Ort.</label>
    </div>
  </div>
  <div class="inline field">
    <div class="ui toggle checkbox">
      <input id="leave_of_absence" type="checkbox" tabindex="0" class="hidden" name="leave_of_absence">
      <label>Ich brauche eine Befreiung von Schule, Universiät oder ähnlichem.</label>
    </div>
  </div>
  <div class="field">
    <label>Anmerkungen zu meiner Befreiung</label>
    <!-- FIXME: This should only be active if leave_of_absence is checked-->
    <textarea id="leave_of_absence_note" rows="2" name="leave_of_absence_note" disabled></textarea>
  </div>
  <h4 class="ui dividing header">Tätigkeiten</h4>
  <div class="field">
  <label>Für welche Teams interessierst du dich?</label>
  <!-- FIXME: render teams with details-->
  <div class="ui items">
    {% for team in teams %}
    <div class="item">
      <div class="image">
        {% if not team.image %}
          <img class="img-fluid" src="{% static "assets/4_3_placeholder.png" %}">
        {% else %}
          <img class="img-fluid" src="{{ team.image.url }}">
        {% endif %}
      </div>
      <div class="content">
        <a class="header">{{ team }}</a>
        <div class="meta">
          <span>{{ team.lead|default_if_none:"Kein Gewerkeleiter" }}</span>
        </div>
        <div class="description">
          <p>{{ team.description }}</p>
        </div>
        <div class="extra">
          <div class="extra">
            <div class="ui toggle checkbox">
              <input type="checkbox" tabindex="0" class="hidden" name="team_{{ team.id }}">
              <label>Interesse</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <h4 class="ui dividing header">Verschiedenes</h4>
    <div class="field">
      <label>Möchtest du uns noch etwas mitteilen?</label>
      <textarea name="general_note"></textarea>
    </div>
    <h4 class="ui dividing header">Rechtliches</h4>
    <div class="inline field">
      <div class="ui toggle checkbox">
        <input id="allow_contact" type="checkbox" tabindex="0" class="hidden" name="allow_contact">
        <label>Ich bin damit einverstanden, dass der CPYE e.V. mich kontaktieren für Dinge rund um den Rocktreff kontaktieren darf.</label>
      </div>
    </div>
    <div class="inline field">
      <div class="ui toggle checkbox">
        <input id="read_privacy" type="checkbox" tabindex="0" class="hidden" name="read_privacy">
        <!-- FIXME: link to privacy policy -->
        <label>Ich habe die Datenschutzbestimmungen zur Kenntnis genommen und erkläre mich mit der Speicherung und Verarbeitung persönlichen Daten im Rahmen des ROCKTREFFs einverstanden.</label>
      </div>
    </div>
    <div class="equal width fields">
      <div class="field">
        <div id="form_submit" class="fluid ui submit button teal" tabindex="0">Absenden</div>
      </div>
      <div class="field">
        <div class="fluid ui reset button grey">Neustart</div>
      </div>
    </div>
    <div class="ui error message"></div>
</form>

{% endblock content %}
