{% extends "base.html" %} {% block content %}{% load static %}

<script language="javascript">
  ajax_success = (data) => {
    console.info(data)
    window.location.href = ""
  }
  ajax_error = (data) => {
    // FIXMIE: needs error handling
    console.error(data)
  }
  ajax_complete = (data) => {
    // hopenfully this is never triggered
    console.info(data)
  }

  const send_form = (fields) => {
    console.debug(fields)
    $.ajax({
      type: "POST",
      url: "{% url "api_exhibitor_signup" slug=slug %}",
      data: JSON.stringify(fields),
      contentType: "application/json",
      headers: {
        "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val(),
      },
      mode: "same-origin",
      dataType: "json",
      success: (data) => ajax_success(data),
      error: (data) => ajax_error(data),
      complete: (data) => ajax_complete(data)
    })
  }

</script>

<div><h1>Neue Austelleranmeldung</h1></div>

<form class="row g-3">
  {% csrf_token %}
  <div><h2>Organisation</h2></div>
  <div class="col-md-12">
    <label for="organisation_name">Organisation Name</label>
    <input type="text" class="form-control" id="organisation_name" name="organisation_name" placeholder="Organisation Name" autocomplete="off" />
  </div>
  <div class="col-md-9">
    <label for="organisation_address">Straße</label>
    <input type="text" name="organisation_address" class="form-control" id="organisation_address" placeholder="Straße" autocomplete="street-address" />
  </div>
  <div class="col-md-3">
    <label for="organisation_address_housenumber">Hausnummer</label>
    <input type="text" class="form-control" name="organisation_address_housenumber" id="organisation_address_housenumber" placeholder="Hausnummer" />
  </div>
  <div class="col-md-12">
    <label for="organisation_address_extension">Addresszusatz</label>
    <input type="text" class="form-control" name="organisation_address_extension" id="organisation_address_extension" placeholder="Addresszusatz" autocomplete="off" />
  </div>
  <div class="col-md-6">
    <label for="organisation_zipcode">Postleitzahl</label>
    <input type="text" pattern="[\d+]{5}" name="organisation_zipcode" id="organisation_zipcode" class="form-control" placeholder="Postleitzahl" maxlength="5" autocomplete="postal-code" />
  </div>
  <div class="col-md-6">
    <label for="organisation_place">Ort</label>
    <input type="text" class="form-control" name="organisation_place" id="user_place" placeholder="Ort" autocomplete="home city"/>
  </div>
  <div><h2>Kontakt</h2></div>
  <div class="col-md-6">
    <label for="organisation_zipcode">E-Mail Adresse</label>
    <input type="email" name="organisation_email" id="organisation_email" class="form-control" placeholder="E-Mail Adresse" autocomplete="email" />
  </div>
  <div class="col-md-6">
    <label for="organisation_place">E-Mail Adresse bestätigen</label>
    <input type="email" name="organisation_email_confirmation" id="organisation_email_confirmation" class="form-control" placeholder="E-Mail Adresse bestätigen" autocomplete="off" />
  </div>
  <div class="col-md-6">
    <label for="organisation_place">Handynummer</label>
    <input type="tel" name="organisation_mobile" id="organisation_mobile" class="form-control" placeholder="Handynummer" autocomplete="tel" />
  </div>
  <div class="col-md-6">
    <label for="organisation_place">Festnetz</label>
    <input type="tel" name="organisation_phone" id="organisation_phone" class="form-control" placeholder="Festnetz" autocomplete="tel" />
  </div>
  <div><h2>Anwesenheit</h2></div>
  <div class="col-md-12">
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">Tag</th>
          <th scope="col">Aktiv</th>
          <th scope="col">Personen</th>
        </tr>
      </thead>
      <tbody>
        {% for day in attendances %}
          <tr>
            <td>{{ day }}</td>
            <td data-label="Aktiv"><input class="form-check-input" type="checkbox" value="" id="attendance_{{ day.id }}" name="attendance_{{ day.id }}"></td>
            <td data-label="Personen"><input type="text" pattern="[\d+]{5}" class="form-control" name="attendance_count_{{ day.id }}" placeholder="Anzahl Personen" maxlength="5" autocomplete="off" disabled /></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div><h2>Ausstattungsbedarf</h2></div>
  <div class="col-md-12">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Artikel</th>
          <th>Bedarf</th>
          <th>ggf. Menge</th>
        </tr>
      </thead>
      <tbody>
        {% for asset in assets %}
          <tr>
            <td><i class="{{ asset.icon }} icon"></i>{{ asset }}<br /><i>{{ asset.explanation }}</i></td>
            <td data-label="Artikel"><input class="form-check-input" type="checkbox" value="" id="asset_{{ asset.id }}" name="asset_{{ asset.id }}"></td>
            {% if asset.is_bool %}
              <td data-label="Menge"></td>
            {% else %}
              <td data-label="Menge"><input type="text" pattern="[\d+]{5}" class="form-control" name="asset_count_{{ asset.id }}" placeholder="Menge" maxlength="5" autocomplete="off" disabled /></td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div><h2>Verschiedenes</h2></div>
  <div class="col-md-12">
    <div class="form-group">
      <label for="general_note">Möchtest du uns noch etwas mitteilen?</label>
      <textarea class="form-control" name="general_note" id="general_note" rows="3"></textarea>
  </div>
  {% include "snippets/rechtliches.html" %}
  <div class="col-md-12">
    <div class="row">
      <div class="col">
        <button id="form_submit" type="button" class="btn btn-primary">Absenden</button>
      </div>
      <div class="col">
        <button id="form_reset" type="button" class="btn btn-secondary">Neustart</button>
      </div>
    </div>
  </div>
  <div class="ui error message"></div>
  <div class="col-md-12" id="error_messages">
  </div>
</form>

{% endblock content %}
