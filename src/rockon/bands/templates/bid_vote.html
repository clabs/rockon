{% extends "base.html" %}
{% block content %}
    {% load static %}
    {% load compress %}
    {% csrf_token %}
    <h1>Bandbewertung</h1>
    {% compress js file vue %}
        <script src="{% static 'vendor/vue.global.3.5.22.min.js' %}"></script>
    {% endcompress %}
    {% compress js file wavesurfer %}
        <script src="{% static 'vendor/wavesurfer.7.5.0.min.js' %}"></script>
    {% endcompress %}
    {% compress js file simplelightbox %}
        <script src="{% static 'vendor/simple-lightbox.2.13.0.min.js' %}"></script>
    {% endcompress %}
    {% compress css file simplelightbox %}
        <link rel="stylesheet" type="text/css" href="{% static 'vendor/simple-lightbox.2.13.0.min.css' %}">
    {% endcompress %}
    <script nonce="{{ csp_nonce }}">
        window.rockon_data = {
            event_slug: "{{ current_event.slug }}",
            tracks: {{ tracks }},
            federal_states: {{ federal_states }},
            bid_states: {{ bid_states }},
            selectedTrackId: {{ trackid }},
            selectedBand: {{ bandid }},
            user_votes: {{ user_votes }},
            placeholder: "{% static 'assets/4_3_placeholder.webp' %}",
            media_offline: "{% static 'assets/media-offline.webp' %}"
        }
        window.rockon_api = {
            list_bands: "/api/v2/bands/",
            update_band: "/api/v2/bands/pk_placeholder",
            fetch_rating: "/api/v2/band-votes/pk_placeholder",
            comments_api: "/api/v2/comments/",
            band_vote: "/api/v2/band-votes/",
            allow_changes: {{ allow_changes }},
            allow_votes: {{ allow_votes }},
        }
    </script>
    {% verbatim %}
    <div id="app">
        <track-list :tracks="tracks" :bands="bands" :selected-track="selectedTrack" :selected-band="selectedBand" :show-band-no-name="showBandNoName"
            :show-incomplete-bids="showIncompleteBids" :show-declined-bids="showDeclinedBids"
            :bid-states="bidStates"
            :federal-states="federalStates" :selected-federal-states="selectedFederalStates"
                @select-track="selectTrack" @filter-no-name="handleFilterShowBandNoNameChange"
                @filter-incomplete-bids="handleFilterIncompleteBidsChange"
                @filter-declined-bids="handleFilterDeclinedBidsChange"
                @update:selected-federal-states="handleFederalStatesChange">
        </track-list>
        <loading-spinner v-if="!bandListLoaded" :bands-to-fetch="bandsToFetch" :bands="bands"></loading-spinner>
         <band-list v-if="bandListLoaded && !selectedBand" :filtered-bands="filteredBands"
             :selected-track="selectedTrack"
             :federal-states="federalStates" :user-votes="userVotes"
             :view-mode="viewMode" :sort-field="sortField" :sort-direction="sortDirection"
             :tracks="tracks"
             @select-band="selectBand"
             @update:view-mode="handleViewModeChange"
             @update:sort-field="handleSortFieldChange"
             @update:sort-direction="handleSortDirectionChange"></band-list>
        <band-details v-if="selectedBand && selectedBandDetails" :selected-band-details="selectedBandDetails"
                      :allow-votes="allowVotes" :allow-changes="allowChanges" :tracks="tracks"
                      :federal-states="federalStates" :comment-api="bandCommentsUrl" :filtered-bands="navigationBandList || filteredBands"
                      @update:track="updateTrack" @update:select-song="handleSongSelect" @update:rating="setRating"
                      :bid-states="bidStates" @update:bid-status="updateBidStatus" @navigate-to-band="selectBand"></band-details>
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="toastAudioPlayer"
                     class="toast"
                     role="alert"
                     aria-live="assertive"
                     aria-atomic="true"
                     data-bs-autohide="false">
                        <div class="toast-header">
                        <strong class="me-auto">
                            <i class="fas fa-music" style="padding-right: 0.5em;"></i>
                            <span v-if="toastIsMaximized">Rockify</span>
                            <div v-else class="scrolling-container">
                                <div class="scrolling-text-wrapper">
                                    <span class="scrolling-text"><a :href="'#/bid/' + playSongBand.guid + '/'" @click.prevent="navigateToPlayingBand" class="band-link">{{ playSongBand.name || playSongBand.guid || "" }}</a> - {{ playSong.file_name_original }}</span>
                                </div>
                            </div>
                        </strong>
                        <button type="button" :class="['btn btn-sm btn-player-control me-2', { 'raccoon-active': raccoonRadioPlaylist && raccoonRadioPlaylist.length }]" @click="raccoonRadioMode" title="Raccoon Radio" aria-label="Raccoon Radio">ü¶ùüìª</button>
                        <button class="btn"
                                style="color: var(--rockon-btn-close-color)"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#player-toast-body"
                                :aria-expanded="toastIsMaximized"
                                aria-controls="player-toast-body"
                                @click="toggleIcon"
                                title="Minimieren">
                            <i :class="toastIsMaximized ? 'fas fa-chevron-down' : 'fas fa-chevron-up'"></i>
                        </button>
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="toast"
                                aria-label="Close"
                                @click="handleCloseClick"
                                title="Schlie√üen"></button>
                    </div>
                    <div id="player-toast-body"
                         :class="['collapse', { 'show': toastIsMaximized }]">
                        <div class="toast-body">
                            <template v-if="raccoonRadioPlaylist && raccoonRadioPlaylist.length">
                                <h5 class="playlist-title" style="margin-bottom: 0.5rem;">ü¶ùüìª Raccoon Radio</h5>
                                <div class="raccoon-radio-playlist mb-2">
                                    <ul class="raccoon-radio-list mb-2">
                                        <li v-for="(item, idx) in raccoonRadioPlaylist" :key="item.id" @click="playQueueStartAt(idx)" :class="{ 'active-play': (playQueue && playQueue.length) ? playQueueIndex === idx : (playSong && playSong.id === item.id) }" aria-current="(playQueue && playQueue.length) ? playQueueIndex === idx : (playSong && playSong.id === item.id)">
                                            <div class="playlist-track-flex">
                                                <div class="playlist-artwork">
                                                    <img
                                                        :src="item.bandPressPhoto || item.bandLogo || placeholder"
                                                        :alt="item.bandName + ' photo'"
                                                        class="playlist-art-img"
                                                        loading="lazy"
                                                        @error="event => event.target.src = placeholder"
                                                    />
                                                </div>
                                                <div class="playlist-track-meta">
                                                    <div class="playlist-track-title">{{ item.bandName }} ‚Äì {{ item.songName }}</div>
                                                </div>
                                                <div class="playlist-play-indicator">
                                                    <i v-if="isPlaying && ((playQueue && playQueue.length) ? playQueueIndex === idx : (playSong && playSong.id === item.id))" class="fa-solid fa-volume-high"></i>
                                                    <i v-else-if="(playQueue && playQueue.length) ? playQueueIndex === idx : (playSong && playSong.id === item.id)" class="fa-solid fa-play"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </template>
                            <song-info v-if="playSong" :song="playSong" :band="playSongBand" @navigate-to-band="navigateToPlayingBand"></song-info>
                            <div class="player-mode-container d-flex align-items-center mb-2">
                                <div class="player-mode d-flex align-items-center">
                                    <span class="player-mode-label me-2">Mode</span>
                                    <button type="button" class="btn btn-sm btn-player-control" @click="togglePlayerEndBehavior" :title="playerEndTitle" aria-label="Playback mode">
                                        <template v-if="playerEndBehavior === 'loop-one'">
                                            <i class="fa-solid fa-repeat"></i>
                                            <span class="repeat-one-badge">1</span>
                                        </template>
                                        <template v-else>
                                            <i :class="playerEndIcon"></i>
                                        </template>
                                    </button>
                                </div>
                                <div class="player-time ms-3">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</div>
                            </div>
                            <div id="player-wrapper" class="player-wrapper"></div>
                            <div class="d-flex justify-content-center gap-2 mt-2 align-items-center">
                                <button type="button" class="btn btn-sm btn-player-control" @click="playPreviousTrack" :disabled="!canPlayPrevious" title="Vorheriger Track">
                                    <i class="fa-solid fa-step-backward"></i>
                                </button>

                                <button type="button" class="btn btn-sm btn-player-control" @click="togglePlayPause" :disabled="!playSong" title="Play / Pause">
                                    <i :class="isPlaying ? 'fa-solid fa-pause' : 'fa-solid fa-play'"></i>
                                </button>

                                <button type="button" class="btn btn-sm btn-player-control" @click="stopPlayback" :disabled="!isPlaying && currentTime === 0" title="Stopp">
                                    <i class="fa-solid fa-stop"></i>
                                </button>

                                <button type="button" class="btn btn-sm btn-player-control" @click="skipBack15" :disabled="!isPlaying" title="Zur√ºck 10s">
                                    <i class="fa-solid fa-rotate-left"></i>
                                    <span class="small ms-1">-10s</span>
                                </button>

                                <button type="button" class="btn btn-sm btn-player-control" @click="skipForward15" :disabled="!isPlaying" title="Vor 10s">
                                    <i class="fa-solid fa-rotate-right"></i>
                                    <span class="small ms-1">+10s</span>
                                </button>

                                <button type="button" class="btn btn-sm btn-player-control" @click="playNextTrack" :disabled="!canPlayNext" title="N√§chster Track">
                                    <i class="fa-solid fa-step-forward"></i>
                                </button>

                                <div class="speaker-container ms-3" :class="{ 'open': volumePopupOpen }">
                                    <button type="button" class="btn btn-sm btn-player-control speaker-icon" :title="'Volume: ' + Math.round(volume*100) + '%'" aria-label="Volume" @click.prevent="toggleVolumePopup">
                                        <i class="fa-solid fa-volume-high"></i>
                                    </button>
                                    <div class="volume-popup" :aria-hidden="!volumePopupOpen" @pointerdown.stop>
                                    <div id="volumeSlider" class="volume-track" role="slider" tabindex="0"
                                         :aria-valuemin="0" :aria-valuemax="100" :aria-valuenow="Math.round(volume*100)"
                                         aria-label="Lautst√§rke"
                                             @pointerdown="startVolumeDrag($event)" @keydown="onVolumeKeyDown($event)" style="position: relative;">
                                            <div class="volume-fill" :style="{ height: (volume*100) + '%' }"></div>
                                            <div class="volume-thumb" :style="{ bottom: (volume*100) + '%' }" ></div>
                                            <div class="volume-tooltip" v-show="volumeTooltipVisible" :style="{ bottom: (volume*100) + '%' }">{{ volumeTooltip }}%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endverbatim %}
    <style>
        /* Emoji Reactions */
        .emoji-reactions-container {
            position: relative;
            width: 100%;
            margin-top: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .emoji-bubbles-overlay {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 9999;
        }

        .emoji-bubble {
            position: absolute;
            bottom: -3rem;
            font-size: 2.4rem;
            animation: emoji-fly-up 3s ease-out forwards;
            will-change: transform, opacity;
            filter: drop-shadow(0 0 4px rgba(0,0,0,0.3));
        }

        @keyframes emoji-fly-up {
            0% {
                transform: translateY(0) scale(0.5) rotate(0deg);
                opacity: 1;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(-105vh) scale(1.3) rotate(15deg);
                opacity: 0;
            }
        }

        .emoji-bar-floating {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            z-index: 10000;
            background: rgba(30, 30, 30, 0.85);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 0.75rem;
            padding: 0.5rem;
        }

        .emoji-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.5rem;
            font-size: 1.5rem;
            padding: 0.3rem 0.6rem;
            cursor: pointer;
            transition: transform 0.15s ease, background 0.15s ease;
            line-height: 1;
        }

        .emoji-btn:hover {
            transform: scale(1.25);
            background: rgba(255, 243, 0, 0.15);
        }

        .emoji-btn:active {
            transform: scale(0.9);
        }

            .playlist-art-img {
                width: 32px;
                height: 32px;
                object-fit: cover;
                object-position: center;
                border-radius: 6px;
                background: #222;
                display: block;
            }
        .highlight {
            color: #fff300;
        }

        .image-container {
            overflow: hidden;
            /* Optimize for repaints */
            contain: layout style paint;
            position: relative;
            height: 250px;
            background-color: #2a2a2a;
        }

        /* Skeleton loading placeholder */
        .skeleton-loader {
            position: absolute;
            top: 0;
            overflow: visible;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                #2a2a2a 0%,
                #3a3a3a 50%,
                #2a2a2a 100%
            );
            background-size: 200% 100%;
            animation: skeleton-pulse 1.5s ease-in-out infinite;
        }

        /* Skeleton text placeholder */
        .skeleton-text {
            display: inline-block;
            background: linear-gradient(
                90deg,
                #2a2a2a 0%,
                #3a3a3a 50%,
                #2a2a2a 100%
            );
            background-size: 200% 100%;
            animation: skeleton-pulse 1.5s ease-in-out infinite;
            border-radius: 4px;
            vertical-align: middle;
        }

        @keyframes skeleton-pulse {
            0% {
                z-index: 40;
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* Player wrapper and behavior button */
        #player-wrapper.player-wrapper {
            position: relative;
        }

        .btn-player-behavior {
            position: absolute;
            top: 6px;
            right: 6px;
            z-index: 10;
            opacity: 0.95;
        }

        /* Player mode moved above waveform */
        .player-mode-container {
            display: flex;
            align-items: flex-start;
        }

        .player-mode {
            margin-right: 0.75rem;
        }

        .player-mode .btn-player-control {
            width: 72px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .player-mode-label {
            font-size: 0.825rem;
            color: var(--bs-body-color);
            opacity: 0.9;
            user-select: none;
        }

        .repeat-one-badge {
            display: inline-block;
            font-size: 0.65em;
            line-height: 1;
            background: rgba(0,0,0,0.15);
            border-radius: 999px;
            padding: 0.08rem 0.25rem;
            margin-left: 0.25rem;
            vertical-align: super;
        }

        /* Detail page image skeleton */
        .detail-image-container {
            position: relative;
            min-height: 200px;
            min-width: 200px;
            max-height: 250px;
            display: inline-block;
            background-color: #2a2a2a;
            border-radius: 4px;
            overflow: hidden;
            transition: background-color 0.3s ease-in-out;
        }

        .detail-image-container.loaded {
            background-color: transparent;
        }

        .detail-image {
            max-height: 250px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .detail-image.loaded {
            opacity: 1;
        }

        .zoom-image {
            transition: transform 0.6s ease-in-out, opacity 0.3s ease-in-out;
            transform: scale(1);
            /* GPU acceleration for smoother animations */
            will-change: transform;
            backface-visibility: hidden;
            opacity: 0;
        }

        .zoom-image.loaded {
            opacity: 1;
        }

        .card:hover .zoom-image.loaded {
            transform: scale(1.1);
        }

        /* Optimize card rendering for large lists */
        .card-group {
            contain: layout style;
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(calc(-100% + 230px));
            }
            100% {
                transform: translateX(0);
            }
        }

        .scrolling-text-wrapper {
            display: flex;
            width: max-content;
            animation: scroll 15s linear infinite;
        }

        .scrolling-container {
            width: 230px; /* Adjust the width as needed */
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
            position: relative;
        }

        .scrolling-text {
            white-space: nowrap;
        }

        /* Player control buttons */
        .btn-player-control {
            color: #fff300;
            border-color: #fff300;
            transition: all 0.2s ease;
        }

        .btn-player-control:hover:not(:disabled) {
            background-color: #fff300;
            color: #000;
        }

        .btn-player-control:disabled {
            color: #666;
            border-color: #444;
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Volume slider styling */
        .player-volume input[type="range"] {
            width: 120px;
        }

        .player-time {
            font-size: 0.9rem;
            color: var(--bs-body-color);
        }

        /* Speaker hover popup for volume */
        .speaker-container {
            position: relative;
            display: inline-block;
        }

        .speaker-container .volume-popup {
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) translateY(8px) scaleY(0.95);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease, transform 0.15s ease, visibility 0.15s;
            background: rgba(0,0,0,0.6);
            padding: 6px;
            border-radius: 6px;
            z-index: 30;
            width: 40px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
        }

        .volume-track {
            position: relative;
            width: 18px;
            height: 100%;
        }

        .volume-fill {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 0;
            width: 8px;
            background: #fff300;
            border-radius: 8px;
            box-shadow: inset 0 -6px 8px rgba(0,0,0,0.15);
        }

        .volume-thumb {
            position: absolute;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 14px;
            height: 14px;
            background: #f1f1f1;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.25);
            pointer-events: none;
            z-index: 9998;
        }

        .volume-tooltip {
            position: absolute;
            right: calc(100% + 8px);
            transform: translateY(-50%);
            background: rgba(0,0,0,0.92);
            color: #fff;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            pointer-events: none;
            z-index: 9999;
        }

        .speaker-container.open .volume-popup,
        .speaker-container:hover .volume-popup,
        .speaker-container:focus-within .volume-popup {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0) scaleY(1);
        }

        .speaker-container .volume-popup input[type="range"] {
            width: 160px;
            /* rotate into vertical orientation but keep the input centered inside the popup */
            transform: rotate(-90deg);
            transform-origin: center;
            accent-color: #fff300;
            -webkit-appearance: none;
        }

        /* webkit track/thumb styling for better visibility */
        .speaker-container .volume-popup input[type="range"]::-webkit-slider-runnable-track {
            height: 6px;
            background: rgba(255,243,0,0.95);
            border-radius: 4px;
        }
        .speaker-container .volume-popup input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #888; /* grey thumb */
            border-radius: 50%;
            margin-top: -4px;
            border: 2px solid rgba(0,0,0,0.2);
        }
        .speaker-container .volume-popup input[type="range"]::-moz-range-thumb {
            background: #888;
            border: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        /* Toast width: smaller but keep responsive */
        #toastAudioPlayer {
            min-width: 420px;
            max-width: calc(100vw - 2rem);
            /* slightly smaller padding inside toast body for compactness */
        }

        /* Prevent page jump when scrollbar appears/disappears */
        html {
            overflow-y: scroll;
        }

        /* Filter badge styles */
        .filter-badge {
            font-size: 0.9rem;
            padding: 0.5em 0.75em;
            border: 2px solid #fff300 !important;
        }

        /* Status filter dropdown */
        .status-filter-menu {
            background-color: var(--bs-dark, #212529);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--bs-body-color);
            min-width: 200px;
        }

        .status-filter-menu .dropdown-item {
            color: var(--bs-body-color);
            padding: 0.4rem 1rem;
        }

        .status-filter-menu .dropdown-item:hover {
            background-color: rgba(255, 243, 0, 0.08);
            color: #fff;
        }

        .status-filter-menu .dropdown-item.active {
            background-color: #fff300;
            color: #000;
        }

        .status-filter-menu .dropdown-divider {
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Inactive badges - outline yellow */
        .text-bg-outline-primary,
        .filter-badge.text-bg-primary {
            background-color: transparent !important;
            border: 2px solid #fff300 !important;
            color: #fff300 !important;
        }

        .text-bg-outline-primary:hover,
        .filter-badge.text-bg-primary:hover {
            background-color: rgba(255, 243, 0, 0.2) !important;
        }

        /* Active filter/track state - filled yellow */
        .filter-badge.text-bg-success {
            background-color: #fff300 !important;
            color: #000 !important;
            border: 2px solid #fff300 !important;
        }

        /* Filter options container */
        .filter-options-container {
            padding-left: 1rem;
        }

        /* Form switch styling - ensure checked state is visible */
        .form-check-input:checked {
            background-color: #198754 !important;
            border-color: #198754 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e") !important;
        }

        .form-check-input {
            cursor: pointer;
        }

        .form-check-label {
            cursor: pointer;
        }

        /* Band link in player toast */
        .band-link {
            color: #fff300 !important;
            text-decoration: none;
            cursor: pointer;
        }

        .band-link:hover {
            text-decoration: underline;
        }

        /* Raccoon Radio playlist styling */
        .raccoon-radio-playlist {
            background: linear-gradient(180deg, rgba(30,30,30,0.98), rgba(20,20,20,0.98));
            border-radius: 12px;
            padding: 10px 14px 8px 14px;
            color: #e6e6e6;
            max-height: 180px;
            overflow-y: auto;
            box-shadow: 0 6px 18px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.06);
        }

        .raccoon-radio-playlist .playlist-title {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: #fff300;
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        .raccoon-radio-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .raccoon-radio-list li {
            padding: 0;
            margin-bottom: 2px;
        }

        .playlist-track-flex {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 7px 8px 7px 6px;
            border-radius: 7px;
            transition: background 0.13s;
        }

        .raccoon-radio-list li.active-play .playlist-track-flex {
            background: linear-gradient(90deg, #fff30022 0%, #fff3000a 100%);
            border-left: 3px solid #ffd700;
            box-shadow: 0 2px 8px 0 rgba(255,215,0,0.08);
        }

        .playlist-track-flex:hover {
            background: rgba(255,255,255,0.04);
            cursor: pointer;
        }

        .playlist-artwork {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #fff30033 0%, #fff30011 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff300;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .playlist-track-meta {
            flex: 1 1 auto;
            min-width: 0;
        }

        .playlist-track-title {
            color: #fff;
            font-weight: 600;
            font-size: 1.01em;
            letter-spacing: 0.01em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .playlist-play-indicator {
            width: 28px;
            text-align: right;
            color: #fff300;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        /* Highlighted raccoon button */
        .raccoon-active {
            background: var(--rockon-primary);
            color: #000 !important;
            border-color: #ffd700 !important;
            box-shadow: 0 4px 12px rgba(255,215,0,0.25);
        }

        /* Band navigation chevron buttons */
        .btn-nav-chevron {
            background: transparent;
            border: 2px solid var(--rockon-primary);
            color: var(--rockon-primary);
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-nav-chevron:hover:not(:disabled) {
            background: var(--rockon-primary);
            color: #000;
            transform: scale(1.05);
        }

        .btn-nav-chevron:disabled {
            opacity: 0;
            cursor: default;
        }

        /* List view table styles */
        .band-list-table {
            --bs-table-bg: transparent;
            --bs-table-hover-bg: rgba(255, 243, 0, 0.08);
            --bs-table-color: var(--bs-body-color);
            border-collapse: separate;
            border-spacing: 0;
            color: var(--bs-body-color);
        }

        .band-list-table thead th {
            border-bottom: 2px solid rgba(255, 243, 0, 0.3);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.6rem 0.75rem;
            white-space: nowrap;
            color: var(--bs-body-color);
        }

        .band-list-th-sort {
            cursor: pointer;
            user-select: none;
        }

        .band-list-th-sort:hover {
            color: #fff300 !important;
            background-color: rgba(255, 243, 0, 0.05);
        }

        .band-list-th-static {
            cursor: default;
        }

        .sort-indicator {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .band-list-row {
            transition: background-color 0.15s ease;
            cursor: pointer;
        }

        .band-list-row:hover {
            background-color: rgba(255, 243, 0, 0.08) !important;
        }

        .band-list-row td {
            vertical-align: middle;
            padding: 0.4rem 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--bs-body-color);
        }

        .band-list-thumb-cell {
            width: 50px;
            padding: 0.25rem 0.5rem !important;
        }

        .band-list-thumb-container {
            width: 44px;
            height: 44px;
            border-radius: 6px;
            overflow: hidden;
            background-color: #2a2a2a;
            position: relative;
            flex-shrink: 0;
        }

        .band-list-thumb {
            width: 44px;
            height: 44px;
            object-fit: cover;
            object-position: center;
            display: block;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .band-list-thumb.loaded {
            opacity: 1;
        }

        .band-list-skeleton {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }

        .band-list-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .band-list-date {
            font-size: 0.85rem;
            white-space: nowrap;
        }

        /* Band toolbar buttons */
        .btn-band-toolbar {
            background-color: transparent;
            border-color: rgba(255, 243, 0, 0.4);
            color: var(--bs-body-color);
        }

        .btn-band-toolbar:hover,
        .btn-band-toolbar:focus {
            background-color: rgba(255, 243, 0, 0.1);
            border-color: rgba(255, 243, 0, 0.7);
            color: #fff300;
        }

        .btn-band-toolbar.active {
            background-color: rgba(255, 243, 0, 0.15);
            border-color: #fff300;
            color: #fff300;
        }

        /* Federal state dropdown - inherits filter-badge styles */
        .federal-state-dropdown-btn {
            vertical-align: middle;
        }

        .federal-state-menu {
            background-color: var(--bs-dark, #212529);
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow-x: hidden;
            min-width: 240px;
            color: var(--bs-body-color);
        }

        .federal-state-menu .dropdown-item-text {
            color: var(--bs-secondary-color, #adb5bd);
        }

        .federal-state-item {
            color: var(--bs-body-color);
            cursor: pointer;
            padding: 0.3rem 0.75rem;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .federal-state-item:hover {
            background-color: rgba(255, 243, 0, 0.08);
            color: #fff;
        }

        .federal-state-item .form-check-input {
            border-color: rgba(255, 255, 255, 0.4);
        }

        .federal-state-item .form-check-input:checked {
            background-color: #fff300;
            border-color: #fff300;
        }

        /* Band card hover/select ‚Äî replaces JS hoverBand/leaveBand */
        .band-card {
            cursor: pointer;
            max-width: 312px;
            height: 380px;
            background-color: var(--rockon-card-bg);
            transition: background-color 0.15s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .band-card .card-body {
            transform: translateZ(0);
        }

        .band-card:hover {
            background-color: var(--rockon-secondary-text-emphasis);
        }

        /* Last row flex container ‚Äî cards keep their max-width instead of stretching */
        .band-card-row {
            display: flex;
            gap: 0;
        }

        .band-card-row > .band-card {
            flex: 0 0 25%;
        }

        /* Card image dimensions ‚Äî moved from inline style */
        .band-card .card-img-top {
            height: 250px;
            object-fit: cover;
            object-position: center;
            opacity: 0;
            transition: transform 0.6s ease-in-out, opacity 0.3s ease-in-out;
            will-change: transform;
            backface-visibility: hidden;
        }

        .band-card .card-img-top.loaded {
            opacity: 1;
        }

        /* Hide skeleton when sibling image is loaded */
        .image-container:has(img.loaded) .skeleton-loader {
            display: none;
        }

        .band-list-thumb-container:has(img.loaded) .skeleton-loader {
            display: none;
        }

        /* Band tags ‚Äî cursor for clickable badges */
        .band-tags .badge {
            cursor: pointer;
            user-select: none;
        }

        /* Song list items */
        .song-list-item {
            cursor: pointer;
        }
    </style>
    {% compress js file voting %}
        <script src="{% static 'js/voting.js' %}"></script>
    {% endcompress %}
{% endblock content %}
